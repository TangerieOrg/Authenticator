version: '3'
services:
  redis:
    image: redislabs/redismod
    volumes:
      - redis-data:/data
      - redis-conf:/usr/local/etc/redis/redis.conf
    deploy:
      replicas: 1
  server:
    image: ${IMAGE_NAME}:latest
    deploy:
      replicas: 1
      labels:
        xyz.tangerie.reverse_proxy.path: "/oauth"
        xyz.tangerie.reverse_proxy.port: "80"
    depends_on:
      - redis
    networks:
      - default
      - nginx-proxy-overlay
  
volumes:
  redis-data:
  redis-conf:

networks:
  default:
  nginx-proxy-overlay:
    external: true
    driver: overlay